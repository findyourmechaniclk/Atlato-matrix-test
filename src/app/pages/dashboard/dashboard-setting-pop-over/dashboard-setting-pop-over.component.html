<!-- dashboard-setting-pop-over.component.html -->

<ng-container *ngIf="visible">
  <div class="custom-modal-overlay">
    <div class="custom-modal-card" style="width: 700px;">
      <!-- Modal Header -->
      <div class="custom-modal-header">
        <span class="custom-modal-title">Settings</span>
        <button class="custom-modal-close" (click)="closeModal()" aria-label="Close" type="button">
          <span nz-icon nzType="close"></span>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="custom-modal-body">
        <form (ngSubmit)="saveSettings()" autocomplete="off">

          <!-- Layout Settings -->
          <div class="form-section">
            <label>Columns count</label>
            <nz-input-number
              [(ngModel)]="formData.columnsCount"
              name="columnsCount"
              [nzMin]="1"
              [nzStep]="1"
              (ngModelChange)="onSettingsChange()"
            ></nz-input-number>
          </div>

          <div class="form-section">
            <label>Minimum layout width</label>
            <div style="display:flex;align-items:center;gap:8px;">
              <nz-input-number
                [(ngModel)]="formData.minLayoutWidth"
                name="minLayoutWidth"
                [nzMin]="1"
                [nzStep]="1"
                (ngModelChange)="onSettingsChange()"
              ></nz-input-number>
              <span>px</span>
            </div>
          </div>

          <div class="form-section">
            <label>Margin between widgets</label>
            <div style="display:flex;align-items:center;gap:8px;">
              <nz-input-number
                [(ngModel)]="formData.marginBetweenWidgets"
                name="marginBetweenWidgets"
                [nzMin]="0"
                [nzStep]="5"
                (ngModelChange)="onSettingsChange()"
              ></nz-input-number>
              <span>px</span>
            </div>
          </div>

          <div class="form-section">
            <label>Apply margin to sides</label>
            <nz-switch
              [(ngModel)]="formData.applyMarginToSides"
              name="applyMarginToSides"
              (ngModelChange)="onSettingsChange()"
            ></nz-switch>
          </div>

          <div class="form-section">
            <label>Auto fill layout height</label>
            <nz-switch
              [(ngModel)]="formData.autoFillLayoutHeight"
              name="autoFillLayoutHeight"
              (ngModelChange)="onSettingsChange()"
            ></nz-switch>
          </div>

          <!-- Background Image Section -->
          <div class="form-section">
            <label>Background image</label>
            <div class="image-row">
              <div class="image-preview-large">
                <img *ngIf="previewImage" [src]="previewImage" alt="Background preview"/>
                <div *ngIf="!previewImage" class="no-image">No image selected</div>
              </div>

              <div class="image-actions">
                <button nz-button nzType="default" class="gallery-btn" type="button" (click)="openGallery()">
                  <span nz-icon nzType="picture"></span>
                  <span>Browse from gallery</span>
                </button>
                <button nz-button nzType="default" class="link-btn" type="button" (click)="showLinkInput = true">
                  <span nz-icon nzType="link"></span>
                  <span>Set link</span>
                </button>
              </div>
            </div>

            <!-- Link Input Row -->
            <div *ngIf="showLinkInput" class="link-input-row">
              <input
                type="text"
                [(ngModel)]="tempImageLink"
                name="tempImageLink"
                placeholder="Enter image URL..."
                class="link-input"
              />
              <button nz-button nzType="primary" class="apply-link-btn" type="button" (click)="setImageLink()">
                <span nz-icon nzType="check"></span>
              </button>
              <button nz-button nzType="default" class="close-link-btn" type="button" (click)="closeLinkInputRow()">
                <span nz-icon nzType="close"></span>
              </button>
            </div>
          </div>

          <!-- Background Size Mode -->
          <div class="form-section">
            <label>Background size mode</label>
            <select [(ngModel)]="formData.backgroundSizeMode" name="bgsize" (ngModelChange)="onSettingsChange()">
              <option *ngFor="let mode of formData.backgroundSizeModes" [value]="mode.value">{{ mode.label }}</option>
            </select>
          </div>

        </form>
      </div>

      <!-- Modal Footer -->
      <div class="custom-modal-footer">
        <button nz-button nzType="default" type="button" (click)="closeModal()">Cancel</button>
        <button nz-button nzType="primary" type="button" (click)="saveSettings()">Save</button>
      </div>
    </div>
  </div>
</ng-container>

<!-- IMAGE GALLERY MODAL -->
<app-image-gallery-pop-over
  [visible]="galleryVisible"
  (close)="closeGallery()"
  (imageSelected)="onGalleryImageSelected($event)"
></app-image-gallery-pop-over>
